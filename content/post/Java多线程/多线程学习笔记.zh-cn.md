---
title: "多线程学习笔记"
date: 2025-07-20T18:44:52+08:00
math: 
draft: false
categories: 
  - Java
  - Notes

---

## Java多线程

---

### 进程与线程

#### 进程
系统运行的基本单位，例如运行一个应用程序

#### 线程
是比进程更小的执行单位。一个进程可以有多个线程，线程是进程的子单位

---

### 并发与并行

#### 并发
指通过**交替运行**的方式，使多个任务事件在同一个时间段发生

#### 并行
指通过**同时处理**的方式，同时运行多个任务事件

ps：对于单核电脑，虽然只有一个CPU，但是可以同时处理多个任务，因此可以认为CPU是**并发**的

---

### 用Java实现多线程的三种方式



#### 继承Thread类
```java
public class MyThread extends Thread{
    // 重写run方法
    @Override
    public void run() {
        // 添加一个任务打印一百次:
        for (int i = 1; i < 101; i++) {
            System.out.println("MyThread线程任务 ---- " + i);
        }
    }
}
```
```java
public class UseMyThread {
    public static void main(String[] args) {
        // 创建一个MyThread对象
        MyThread mt = new MyThread();
        // 调用start方法开启线程
        mt.start();
        // mt.run(); 千万不要调用run方法,因为并没有开启线程,只是一个对象调用一次    方法而已.
        // 这个循环属于main方法所在的线程,就是换一个叫做"main"线程,这线程就是主 线程
        for (int i = 0; i < 100; i++) {
            System.out.println("主线程中的任务---" + i);
        }
    }
}
```
#### 接入Runnable接口
```java

public class MyRunnable implements Runnable{
    // 重写接口中的run方法,定义线程任务内容
    @Override
    public void run() {
        for (int i = 1; i < 101; i++) {
            System.out.println("任务对象----"+i);
        }
    }
}
```
```java

public class UseMyRunnable {
    public static void main(String[] args) {
        // 创建任务类对象
        MyRunnable m1 = new MyRunnable();
        // 创建线程对象,把任务对象绑定到线程中
        Thread t1 = new Thread(m1);
        t1.start();
 
        for (int i = 0; i < 100; i++) {
            System.out.println("主线程------"+i);
        }
    }
}
```
#### 接入Callable接口
```java
public class CallableExample {
    public static void main(String[] args) {
        // 创建一个Callable任务
        Callable<Integer> task = new Callable<Integer>() {
            @Override
            public Integer call() throws Exception {
                int sum = 0;
                for (int i = 1; i <= 1000; i++) {
                    sum += i;
                }
                return sum; // 返回计算结果
            }
        };

        // 将Callable包装成FutureTask
        FutureTask<Integer> futureTask = new FutureTask<>(task);

        // 创建线程并启动
        Thread thread = new Thread(futureTask);
        thread.start();

        try {
            // 获取线程执行结果
            Integer result = futureTask.get();
            System.out.println("Sum from 1 to 1000 is: " + result);
        } catch (InterruptedException | ExecutionException e) {
            e.printStackTrace();
        }
    }
}
```

---

### 任务：用线程在窗口中绘制可运动的小球，要求鼠标点击时产生新的小球，每个小球有独立的运动，且只使用一个线程来控制所有操作
![](https://raw.githubusercontent.com/Ferdinandhu000/my_blog_img/master/20250722154617.png)

#### `Ball.java`
创建一个小球类，定义小球的基本属性并创建相关操作方法
```java
import java.awt.Color;
import java.awt.Graphics;

public class Ball {
    private int x, y;
    private int checkDirectionX = 1;
    private int checkDirectionY = 1;
    private Graphics g;

    public Ball(Graphics g, int x, int y, int checkDirectionX, int checkDirectionY) {
        this.x = x;
        this.y = y;
        this.checkDirectionX = checkDirectionX;
        this.checkDirectionY = checkDirectionY;
        this.g = g;
    }

    public int getX() {
        return x;
    }
    public int getY() {
        return y;
    }
    public Graphics getGraphics() {
        return g;
    }

    // 用于判断小球是否到达边界
    public int getCheckX() {
        return checkDirectionX;
    }
    public int getCheckY() {
        return checkDirectionY;
    }

    public void setX(int x) {
        this.x = x;
    }
    public void setY(int y) {
        this.y = y;
    }

    public void setCheckX(int checkDirectionX) {
        this.checkDirectionX = checkDirectionX;
    }
    public void setCheckY(int checkDirectionY) {
        this.checkDirectionY = checkDirectionY;
    }
}
```

#### `WorkThread.java`
```java
import java.awt.*;

public class WorkThread extends Thread {
    @Override
    public void run() {
        while(true) {
            try {
                // 每10毫秒更新一次小球位置
                Thread.sleep(10);
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
            // 遍历所有小球，更新位置和方向
            for(Ball ball : ThreadListener.balls) {
                int newX = ball.getX() + ball.getCheckX();
                int newY = ball.getY() + ball.getCheckY();
                // 边界检查
                if(newX <= 0 || newX >= 800 - 50) {
                    ball.setCheckX(-ball.getCheckX());
                }
                if(newY <= 0 || newY >= 800 - 50) {
                    ball.setCheckY(-ball.getCheckY());
                }
                // 绘制小球
                draw(ball.getGraphics(), ball.getX(), ball.getY(), ball.getCheckX(), ball.getCheckY());
                ball.setX(newX);
                ball.setY(newY);
            }
        }
    }

    void draw(Graphics g, int x, int y, int checkX, int checkY) {
        g.setColor(Color.WHITE);
        g.fillOval(x, y, 50, 50);
        g.setColor(Color.BLACK);
        g.fillOval(x + checkX, y + checkY, 50, 50);
    }

}
```
#### `ThreadListener.java`
```java
package hj0720;

import java.awt.*;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.util.ArrayList;
import java.util.List;

public class ThreadListener extends MouseAdapter {

    Graphics g;
    // 存储所有小球的列表
    static List<Ball> balls = new ArrayList<>();

    public ThreadListener(Graphics g) {
        this.g = g;
    }

    @Override
    public void mouseClicked(MouseEvent e) {
        int checkX = 1, checkY = 1;
        // 点击时添加新小球（黑色）
        if(e.getX() > 800 - 50) {
            checkX = -1;
        }

        if(e.getY() > 800 - 50) {
            checkY = -1;
        }
        // 每一次点击，将新小球添加到列表中
        balls.add(new Ball(g, e.getX(), e.getY(), checkX, checkY));
    }
}
```

#### `ThreadTestUI.java`

```java
import javax.swing.*;
import java.awt.*;

public class ThreadTestUI {

    private JFrame jf = new JFrame();

    public void initUI() {
        // 设置窗口标题
        jf.setTitle("单线程控制所有小球");
        // 设置窗口关闭操作
        jf.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        // 设置窗口大小
        jf.setSize(800, 800);
        // 设置窗口居中显示
        jf.setLocationRelativeTo(null);

        // 创建面板用于绘制小球
        JPanel jp = new JPanel() {
            @Override
            protected void paintComponent(Graphics g) {
                super.paintComponent(g);
                // 可以在此绘制内容，但这里主要用于获取 Graphics
            }
        };
        // 设置面板背景色为白色
        jp.setBackground(Color.WHITE);
        // 将面板添加到窗口中
        jf.add(jp, BorderLayout.CENTER);
        // 显示窗口
        jf.setVisible(true);

        // 获取面板的Graphics对象
        Graphics g = jp.getGraphics();
        // 创建并添加鼠标监听器，用于在点击时添加小球
        ThreadListener listener = new ThreadListener(g);
        jf.addMouseListener(listener);

        // 启动工作线程，负责更新和绘制小球
        WorkThread wt = new WorkThread();
        wt.start();
    }

    public static void main(String[] args) {
        new ThreadTestUI().initUI();
    }
}
```